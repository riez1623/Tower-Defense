<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Tower Defense</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        #game-container {
            width: 1000px;
            height: 600px;
            margin: 20px auto;
            background-color: #e0e0e0;
            position: relative;
        }
        .tower {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: blue;
            cursor: pointer;
        }
        .enemy {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: red;
            border-radius: 50%;
        }
        .bullet {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: green;
            border-radius: 50%;
        }
        .ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: black;
            font-size: 18px;
        }
        .upgrade-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="game-container"></div>
<div class="ui" id="score">Score: 0</div>
<div class="ui" id="health">Health: 20</div>
<div class="ui" id="money">Money: 0</div>
<div class="upgrade-button" id="upgrade-button">Upgrade Tower</div>

<script>
    const gameContainer = document.getElementById("game-container");
    const scoreDisplay = document.getElementById("score");
    const healthDisplay = document.getElementById("health");
    const moneyDisplay = document.getElementById("money");
    const upgradeButton = document.getElementById("upgrade-button");

    let score = 0;
    let health = 20;
    let money = 0;

    const towers = [];
    const bullets = [];
    const enemies = [];
    const paths = [
        { x: 0, y: 200 }, { x: 250, y: 200 }, { x: 250, y: 400 }, { x: 750, y: 400 }, { x: 750, y: 600 }
    ];

    // Enemy constructor
    function createEnemy() {
        const enemy = document.createElement("div");
        enemy.classList.add("enemy");
        enemy.style.left = `${paths[0].x}px`;
        enemy.style.top = `${paths[0].y}px`;
        gameContainer.appendChild(enemy);
        enemies.push({ element: enemy, pathIndex: 0, health: 100, type: 'normal' });
    }

    // Tower constructor
    function createTower(x, y) {
        const tower = document.createElement("div");
        tower.classList.add("tower");
        tower.style.left = `${x - 30}px`;
        tower.style.top = `${y - 30}px`;
        gameContainer.appendChild(tower);
        towers.push({ element: tower, x: x, y: y, level: 1, range: 200, damage: 10 });
    }

    // Move the enemies along the path
    function moveEnemies() {
        enemies.forEach(enemy => {
            if (enemy.pathIndex < paths.length - 1) {
                const target = paths[enemy.pathIndex + 1];
                let dx = target.x - parseFloat(enemy.element.style.left);
                let dy = target.y - parseFloat(enemy.element.style.top);
                let distance = Math.sqrt(dx * dx + dy * dy);
                let speed = enemy.type === 'fast' ? 1.5 : 1;

                if (distance > speed) {
                    let moveX = (dx / distance) * speed;
                    let moveY = (dy / distance) * speed;
                    enemy.element.style.left = parseFloat(enemy.element.style.left) + moveX + "px";
                    enemy.element.style.top = parseFloat(enemy.element.style.top) + moveY + "px";
                } else {
                    enemy.pathIndex++;
                }
            } else {
                // Enemy reaches the end of the path (game over)
                health -= 1;
                healthDisplay.textContent = `Health: ${health}`;
                enemy.element.remove();
                enemies.splice(enemies.indexOf(enemy), 1);
            }
        });
    }

    // Tower shooting logic
    function shootBullets() {
        towers.forEach(tower => {
            enemies.forEach(enemy => {
                let ex = parseFloat(enemy.element.style.left);
                let ey = parseFloat(enemy.element.style.top);
                let tx = tower.x;
                let ty = tower.y;

                let dx = ex - tx;
                let dy = ey - ty;
                let distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < tower.range) { // Towers attack within range
                    const bullet = document.createElement("div");
                    bullet.classList.add("bullet");
                    bullet.style.left = `${tx}px`;
                    bullet.style.top = `${ty}px`;
                    gameContainer.appendChild(bullet);
                    bullets.push({ element: bullet, target: enemy });
                    money += 5;  // Gain money for shooting
                    moneyDisplay.textContent = `Money: ${money}`;
                }
            });
        });
    }

    // Move bullets towards enemies
    function moveBullets() {
        bullets.forEach(bullet => {
            const target = bullet.target.element;
            let bx = parseFloat(bullet.element.style.left);
            let by = parseFloat(bullet.element.style.top);
            let tx = parseFloat(target.style.left);
            let ty = parseFloat(target.style.top);

            let dx = tx - bx;
            let dy = ty - by;
            let distance = Math.sqrt(dx * dx + dy * dy);
            let speed = 3;

            if (distance > speed) {
                let moveX = (dx / distance) * speed;
                let moveY = (dy / distance) * speed;
                bullet.element.style.left = bx + moveX + "px";
                bullet.element.style.top = by + moveY + "px";
            } else {
                target.remove();
                bullet.element.remove();
                bullet.target.element.remove();
                enemies.splice(enemies.indexOf(bullet.target), 1); // Remove enemy
                score += 10;
                scoreDisplay.textContent = `Score: ${score}`;
            }
        });
    }

    // Game loop
    function gameLoop() {
        moveEnemies();
        shootBullets();
        moveBullets();
        if (health > 0) {
            requestAnimationFrame(gameLoop);
        } else {
            alert('Game Over!');
        }
    }

    // Start the game
    function startGame() {
        createTower(150, 250);
        createTower(600, 450);
        createEnemy();
        createEnemy();
        gameLoop();
    }

    // Tower upgrade function
    function upgradeTower() {
        if (money >= 50) {
            // Upgrade the first tower in the list for now (could be made dynamic)
            let tower = towers[0];
            tower.level += 1;
            tower.range += 50;
            tower.damage += 5;
            money -= 50;
            moneyDisplay.textContent = `Money: ${money}`;
        } else {
            alert("Not enough money to upgrade!");
        }
    }

    // Event listener for the upgrade button
    upgradeButton.addEventListener("click", upgradeTower);

    startGame();
</script>

</body>
</html>
